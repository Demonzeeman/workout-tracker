<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Workout Tracker</title>
  <link rel="manifest" href="manifest.json" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { padding: 1rem; background: #f9f9f9; }
    .exercise-entry { margin-bottom: 0.5rem; }
  </style>
</head>
<body>
<div class="container">
  <h2 class="text-center mb-3">üèã Darling Workouts</h2>

  <!-- Controls -->
  <div class="d-flex justify-content-between mb-2">
    <select id="workoutType" class="form-select w-50" onchange="loadExercises()">
      <option value="Push">Push</option>
      <option value="Pull">Pull</option>
      <option value="Legs">Legs</option>
      <option value="Core">Core</option>
      <option value="Cardio">Cardio</option>
    </select>
    <input type="date" id="dateInput" class="form-control w-25 ms-2" />
    <button class="btn btn-primary ms-2" onclick="addExercise()">Add</button>
    <!-- button class="btn btn-secondary ms-2" onclick="exportData()">Export</button -->
  </div>

  <!-- Exercise list -->
  <div id="exerciseList" class="mt-3"></div>
</div>

<!-- Add/Edit Modal -->
<div class="modal fade" id="exerciseModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add Exercise</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <select id="exerciseName" class="form-select mb-2"></select>
        <input type="text" id="exerciseData" class="form-control" placeholder="e.g. 60kg x 10, 80kg x 8" />
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="saveExercise()">Save</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
const exerciseList = document.getElementById("exerciseList");
const dateInput = document.getElementById("dateInput");
const exerciseName = document.getElementById("exerciseName");
const workoutType = document.getElementById("workoutType");
const exerciseData = document.getElementById("exerciseData");
const exerciseModal = new bootstrap.Modal(document.getElementById("exerciseModal"));
let editingIndex = null;
let editingExercise = null;

// Default to today
dateInput.value = new Date().toISOString().split("T")[0];

// Exercises by type
const exercisesByType = {
  Pull: [
    "Deadlifts",
    "Lateral Pulldowns",
    "Cable Rows",
    "Bicep Curls (EZ Bar)",
    "Bent Over Row",
    "Face Pull",
    "Bicep Curl DB",
    "DB Shrugs",
    "Chin Ups",
    "DB Reverse Fly",
    "Dead Hang",
    "Pull Ups"
  ],
  Push: [
    "Chest Press",
    "DB Chest Press",
    "Incline DB Press",
    "Close Grip DB Press",
    "Push Up",
    "Cable Tricep Extension",
    "Shoulder Press DB",
    "Skull Crushers",
    "Lateral Raises",
    "Chest Flys DB",
    "Hammer Curls",
    "Tricep Dips"
  ],
  Legs: [
    "Squat - Standing",
    "Goblet Squat",
    "Belgian Squat",
    "Romanian Deadlift",
    "Hip Thrust",
    "Calf Raises",
    "Hamstring Curl",
    "Abductor",
    "Adductor",
    "Leg Press"
  ],
  Core: [
    "Ab Roller",
    "Hanging Leg Raises",
    "Plank",
    "Russian Twists",
    "Leg Raises",
    "Mountain Climbers",
    "Sit Ups"
  ],
  Cardio: [
    "Treadmill",
    "Elliptical Machine",
    "Stationary Bike",
    "Rowing Machine",
    "Jump Rope",
    "Stair Climber",
  ]
};

// Populate dropdown
function populateExerciseDropdown() {
  exerciseName.innerHTML = "";
  exercisesByType[workoutType.value].forEach(ex => {
    const option = document.createElement("option");
    option.value = ex;
    option.textContent = ex;
    exerciseName.appendChild(option);
  });
}

// Load exercises
function loadExercises() {
  exerciseList.innerHTML = "";
  const allData = JSON.parse(localStorage.getItem("workouts") || "{}");

  let first = true; // optional: expand first section by default

  for (const type in exercisesByType) {
    // Container for each type
    const typeDiv = document.createElement("div");
    typeDiv.className = "mb-3";

    // Header button
    const typeId = `collapse-${type}`;
    const header = document.createElement("button");
    header.className = "btn btn-secondary w-100 text-start mb-2";
    header.setAttribute("data-bs-toggle", "collapse");
    header.setAttribute("data-bs-target", `#${typeId}`);
    header.setAttribute("aria-expanded", first ? "true" : "false");
    header.textContent = type;

    typeDiv.appendChild(header);

    // Collapsible container
    const collapseDiv = document.createElement("div");
    collapseDiv.className = "collapse" + (first ? " show" : "");
    collapseDiv.id = typeId;

    // Exercises within this type
    const exercises = new Set([...Object.keys(allData[type] || {}), ...exercisesByType[type]]);

    exercises.forEach(exercise => {
      const exDiv = document.createElement("div");
      exDiv.className = "mb-2";

      const exTitle = document.createElement("h5");
      exTitle.textContent = exercise;
      exDiv.appendChild(exTitle);

      const entries = (allData[type] && allData[type][exercise]) || [];

      // Quick Add button
      const quickDiv = document.createElement("div");
      quickDiv.className = "exercise-entry d-flex align-items-center border p-2 rounded bg-white mb-1";
      quickDiv.innerHTML = `<button class="btn btn-sm btn-info me-1" onclick="quickAdd('${type}','${exercise}')">Quick Add</button>`;
      exDiv.appendChild(quickDiv);

      // Entries grouped by date
      if (entries.length > 0) {
        const entriesByDate = {};
        entries.forEach(entry => {
          if (!entriesByDate[entry.date]) entriesByDate[entry.date] = [];
          entriesByDate[entry.date].push(entry);
        });

        const sortedDates = Object.keys(entriesByDate).sort((a,b)=>new Date(b)-new Date(a));

        sortedDates.forEach(date => {
          const dateId = `${type}-${exercise}-${date}`.replace(/\s+/g,'');
          const collapseEntryDiv = document.createElement("div");

          const dateHeader = document.createElement("button");
          dateHeader.className = "btn btn-link text-start w-100";
          dateHeader.setAttribute("data-bs-toggle","collapse");
          dateHeader.setAttribute("data-bs-target", `#${dateId}`);
          dateHeader.setAttribute("aria-expanded","false");
          dateHeader.textContent = date;
          collapseEntryDiv.appendChild(dateHeader);

          const content = document.createElement("div");
          content.className = "collapse ps-3 mt-2";
          content.id = dateId;

          entriesByDate[date].forEach((entry, index)=>{
            const div = document.createElement("div");
            div.className = "exercise-entry d-flex justify-content-between align-items-center border p-2 rounded bg-white mb-1";
            div.innerHTML = `${entry.data}
              <div>
                <button class="btn btn-sm btn-warning me-1" onclick="editExercise('${type}','${exercise}',${index})">Edit</button>
                <button class="btn btn-sm btn-danger" onclick="deleteExercise('${type}','${exercise}',${index})">Delete</button>
              </div>`;
            content.appendChild(div);
          });

          collapseEntryDiv.appendChild(content);
          exDiv.appendChild(collapseEntryDiv);
        });
      }

      collapseDiv.appendChild(exDiv);
    });

    typeDiv.appendChild(collapseDiv);
    exerciseList.appendChild(typeDiv);

    first = false; // only first section expanded initially
  }
}

// Add
function addExercise() {
  editingIndex = null;
  editingExercise = null;
  exerciseData.value = "";
  populateExerciseDropdown();
  exerciseModal.show();
}

// Save
function saveExercise() {
  const type = workoutType.value;
  const name = exerciseName.value;
  const date = dateInput.value;
  const entry = {date, data: exerciseData.value};

  const allData = JSON.parse(localStorage.getItem("workouts") || "{}");
  if (!allData[type]) allData[type] = {};
  if (!allData[type][name]) allData[type][name] = [];

  if (editingIndex !== null && editingExercise) {
    allData[type][name][editingIndex] = entry;
  } else {
    allData[type][name].push(entry);
  }

  localStorage.setItem("workouts", JSON.stringify(allData));
  editingIndex = null;
  editingExercise = null;
  exerciseModal.hide();
  loadExercises();
}

// Edit
function editExercise(type, exercise, index) {
  const allData = JSON.parse(localStorage.getItem("workouts") || "{}");
  const entry = allData[type][exercise][index];
  workoutType.value = type;
  exerciseName.value = exercise;
  exerciseData.value = entry.data;
  dateInput.value = entry.date;
  editingIndex = index;
  editingExercise = exercise;
  exerciseModal.show();
}

// Delete
function deleteExercise(type, exercise, index) {
  if (!confirm("Are you sure you want to delete this exercise?")) return;
  const allData = JSON.parse(localStorage.getItem("workouts") || "{}");
  allData[type][exercise].splice(index,1);
  if (allData[type][exercise].length===0) delete allData[type][exercise];
  localStorage.setItem("workouts", JSON.stringify(allData));
  loadExercises();
}

// Export
function exportData() {
  const allData = JSON.parse(localStorage.getItem("workouts") || "{}");
  const blob = new Blob([JSON.stringify(allData,null,2)], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "workouts.json";
  a.click();
  URL.revokeObjectURL(url);
}

// Init
populateExerciseDropdown();
loadExercises();
if ("serviceWorker" in navigator) navigator.serviceWorker.register("service-worker.js");
</script>
</body>
</html>
